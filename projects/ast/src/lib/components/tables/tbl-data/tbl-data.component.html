<div class="ast-table d-flex flex-column justify-content-between w-100">
  <table
    class="filterable-table ast-table__table w-100"
    mat-table
    [dataSource]="dataSource"
  >
    <ng-container matColumnDef="index">
      <th
        mat-header-cell
        *matHeaderCellDef
        [ngStyle]="{ width: '64px', textAlign: 'center' }"
      >
        <h6 class="semi-bold">STT</h6>
      </th>
      <td
        mat-cell
        *matCellDef="let i = index"
        [ngStyle]="{ width: '64px', textAlign: 'center' }"
      >
        {{ i + 1 }}
      </td>
    </ng-container>

    <ng-container
      [matColumnDef]="column.name"
      *ngFor="let column of columns; let i = index"
    >
      <th
        mat-header-cell
        *matHeaderCellDef
        class="filterable-table-header"
        [ngStyle]="{
          width: column.width,
          textAlign: column.headerAlign || 'center'
        }"
      >
        <div>
          <h6 class="semi-bold d-inline">{{ column.header }}</h6>
          <button
            *ngIf="column.isFilterable"
            class="btn filter-btn d-inline"
            (click)="toggleFilterBox(i)"
            type="button"
          >
            <i class="fa-solid fa-filter d-inline-block"></i>
            <p
              class="filter-order-number d-inline-block m-0"
              *ngIf="filter[i] && filter[i].order > 0"
            >
              {{ filter[i].order }}
            </p>
          </button>
          <button
            *ngIf="column.isSortable"
            type="button"
            (click)="sortByColumn(i)"
            class="btn sort-btn d-inline"
          >
            <i *ngIf="sortState[i]" class="fa-solid fa-caret-up"></i>
            <i *ngIf="!sortState[i]" class="fa-solid fa-caret-down"></i>
          </button>
        </div>

        <mat-card
          class="filter-box position-absolute"
          *ngIf="isShowFilterBox[i]"
        >
          <div class="mb-2">
            <div *ngFor="let filterItem of filter[i].list; let j = index">
              <div *ngIf="filterItem.isActive">
                <input
                  type="checkbox"
                  name="{{ column }}"
                  id="{{ column }}_{{ j }}"
                  [checked]="filterItem.isChecked"
                  (change)="toggleFilterOption(i, j)"
                  class="filter-btn"
                />
                <label class="ms-1" for="{{ column }}_{{ j }}">{{
                  filterItem.name
                }}</label>
              </div>
            </div>
          </div>
          <button
            astButtonSolid
            type="button"
            class="apply-filter-btn"
            (click)="applyFilter(i)"
            size="sm"
            width="100%"
          >
            Áp dụng
          </button>
        </mat-card>
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        [ngStyle]="{
          width: column.width,
          textAlign: column.dataAlign || 'center'
        }"
      >
        <p>
          {{ element[column.name] }}
        </p>
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let i = index">
        <div class="d-flex justify-content-end">
          <button
            astButtonIcon
            [matMenuTriggerFor]="buttonMenu"
            [matMenuTriggerData]="{ buttons: buttons[i] }"
          >
            <i class="fa-solid fa-ellipsis"></i>
          </button>
          <mat-menu #buttonMenu="matMenu">
            <ng-template matMenuContent let-buttonList="buttons">
              <div
                *ngFor="let btn of buttonList; let btnIndex = index"
                [class]="btnIndex != 0 ? '' : ''"
              >
                <button mat-menu-item type="button" (click)="btn.action()">
                  <i [class]="'fa-solid ' + btn.icon"></i>
                  <span class="ms-2">{{ btn.text }}</span>
                </button>
              </div>
            </ng-template>
          </mat-menu>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <div class="w-100">
    <mat-paginator
      [pageSizeOptions]="pageSizeOptions"
      aria-label="Select page"
      class="paginator"
    >
    </mat-paginator>
  </div>
</div>
